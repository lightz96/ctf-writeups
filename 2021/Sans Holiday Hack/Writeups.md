# Writeups

## Splunk!
```
Difficulty: 3/5

Help Angel Candysalt solve the Splunk challenge in Santa's great hall. Fitzy Shortstack is in Santa's lobby, and he knows a few things about Splunk. What does Santa call you when when you complete the analysis?
```

### Task 1
```
Capture the commands Eddie ran most often, starting with git. Looking only at his process launches as reported by Sysmon, record the most common git-related CommandLine that Eddie seemed to use.
```

Filter by `git` command and makes use of Splunk's `stats` and `sort`

To do this, we search using the following command:
```
index=main sourcetype=journald source=Journald:Microsoft-Windows-Sysmon/Operational EventCode=1 user=eddie CommandLine=git*
| stats count by CommandLine 
| sort - count
```

You will noticed that `git status` command ran the most by eddie with a total of 5 counts.

Ans: `git status`

### Task 2
```
Looking through the git commands Eddie ran, determine the remote repository that he configured as the origin for the 'partnerapi' repo. The correct one!
```

Using the same Splunk search command as Task 1, we identified that eddie ran `git remote add origin git@github.com:elfnp3/partnerapi.git`
and `git remote add origin https://github.com/elfnp3/partnerapi.git`. The former command ran at a later date.

Ans: `git@github.com:elfnp3/partnerapi.git`

### Task 3
```
Eddie was running Docker on his workstation. Gather the full command line that Eddie used to bring up a the partnerapi project on his workstation.
```

Similarly, we filter by `docker` command and use Splunk's `stats` and `sort`

To do this, we search using the following command:
```
index=main sourcetype=journald source=Journald:Microsoft-Windows-Sysmon/Operational EventCode=1 user=eddie CommandLine=docker*
| stats count by CommandLine 
| sort - count
```

We found that eddie ran `docker compose up` command.

Ans: `docker compose up`

### Task 4
```
Eddie had been testing automated static application security testing (SAST) in GitHub. Vulnerability reports have been coming into Splunk in JSON format via GitHub webhooks. Search all the events in the main index in Splunk and use the sourcetype field to locate these reports. Determine the URL of the vulnerable GitHub repository that the elves cloned for testing and document it here. You will need to search outside of Splunk (try GitHub) for the original name of the repository.
```

We ran the following command to view the Github webhook events:
```
index=main sourcetype=github_json
```

We found `https://github.com/elfnp3/dvws-node/` link from its output. Visiting this github link, we found out that this repo contains vulnerable web service. This indicates that we are on the right track. Next, we found that this repo is forked from `https://github.com/snoopysecurity/dvws-node`.

Ans: `https://github.com/snoopysecurity/dvws-node`


### Task 5
```
Santa asked Eddie to add a JavaScript library from NPM to the 'partnerapi' project. Determine the name of the library and record it here for our workshop documentation.
```

We ran the following command to list all the commands ran by eddie and found out that eddie ran `node /usr/bin/npm install holiday-utils-js` command
```
index=main sourcetype=journald source=Journald:Microsoft-Windows-Sysmon/Operational EventCode=1 user=eddie
| stats count by CommandLine 
| sort - count
```

Ans: `holiday-utils-js`

### Task 6
```
Another elf started gathering a baseline of the network activity that Eddie generated. Start with their search and capture the full process_name field of anything that looks suspicious.
```

We ran the following command to filter network connection activities generated by eddie
```
index=main sourcetype=journald source=Journald:Microsoft-Windows-Sysmon/Operational EventCode=3 user=eddie
```

Clicking on the `process_name` field on the left pane, we found suspicious process name called `/usr/bin/nc.openbsd`

Ans: `/usr/bin/nc.openbsd`

### Task 7
```
Uh oh. This documentation exercise just turned into an investigation. Starting with the process identified in the previous task, look for additional suspicious commands launched by the same parent process. One thing to know about these Sysmon events is that Network connection events don't indicate the parent process ID, but Process creation events do! Determine the number of files that were accessed by a related process and record it here.
```

From Task 6, we identified the PID of the process name is 6791 (`process_id` field on the left pane). To find its PPID, we need to filter by process creation. To do this, we ran the following command:
```
index=main sourcetype=journald source=Journald:Microsoft-Windows-Sysmon/Operational EventCode=1 process_id=6791
```

We identified the PPID of the process name is 6788 (`parent_process_id` field on the left pane). 

We ran the following search command to look for additional commands launched by the same parent process.
```
index=main sourcetype=journald source=Journald:Microsoft-Windows-Sysmon/Operational EventCode=1 parent_process_id=6788
```

We noticed the parent process creates a child process and runs `cat /home/eddie/.aws/credentials /home/eddie/.ssh/authorized_keys /home/eddie/.ssh/config /home/eddie/.ssh/eddie /home/eddie/.ssh/eddie.pub /home/eddie/.ssh/known_hosts` command. This command accesses 6 files.

Ans: `6`

### Task 8
```
Use Splunk and Sysmon Process creation data to identify the name of the Bash script that accessed sensitive files and (likely) transmitted them to a remote IP address.
```

As hinted in the description, we are looking for bash script. This bash script has to be executed in order to perform some actions (e.g. access sensitve files). So, we run the following command to search for command that contains "*.sh".
```
index=main sourcetype=journald source=Journald:Microsoft-Windows-Sysmon/Operational EventCode=1 CommandLine=*.sh
```

We found that it runs `/bin/bash preinstall.sh`

Ans: `preinstall.sh`

By completing all these tasks, we got the following text:
```
Thank you for helping Santa complete his investigation! Santa says you're a whiz!
```

Submit `whiz` and we completed the objective! Hooray!

## Now Hiring!
```
Difficulty: 3/5

What is the secret access key for the Jack Frost Tower job applications server? Brave the perils of Jack's bathroom to get hints from Noxious O. D'or.
```

This objective provides a link to a webpage. The hint by `Noxious O. D'or` indicates that this webpage runs on AWS.

In the webpage, we found a career application form which allows user to input URL (vulnerable to SSRF). To obtain the secret access key, we exploit SSRF to make the webpage interact with the IMDS. Its response is written to a file. So, we need to `wget` the file to view the response.

Detailed Exploitation:
1. In the career application form, specify `http://169.254.169.254/latest/meta-data/iam/security-credentials` as the input for the `URL to your public NLBI report` field and fill in the rest of the input fields.
2. Once you have successfully submitted the application, the webpage returns an image file named "[Name].jpg". `wget` the image file (e.g. https://apply.jackfrosttower.com/images/abc.jpg) and view the content using notepad. The content contains the role name.
3. In the career application form, specify `http://169.254.169.254/latest/meta-data/iam/security-credentials/jf-deploy-role` as the input for the `URL to your public NLBI report` field and fill in the rest of the input fields. 
4. Once you have successfully submitted the application, `wget` the image file to view the secret access key.

Submit `CGgQcSdERePvGgr058r3PObPq3+0CfraKcsLREpX` and we completed the objective! Hooray!